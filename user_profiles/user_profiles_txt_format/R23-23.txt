Author manuscript, published in "Proceedings of the Brazilian Symposium on Computer Graphics and Image Processing, 19
(SIBGRAPI) (2006)"

0
1
0
2

 
t
c
O
3
1

 

 
-
 

i

 

1
n
o
s
r
e
v
 
,

6
2
2
0
1
5
0
0
-
a
i
r
n

i

PlausibleImageBasedSoftShadowsUsingOcclusionTexturesElmarEisemannXavierD·ecoretARTIS-GRAVIR/IMAG-INRIA∗Elmar.Eisemann@inrialpes.frXavier.Decoret@inrialpes.frAbstractThispaperpresentsanovelimage-basedapproachtorenderplausiblesoftshadowsforcomplexdynamicsceneswithrectangularlightsources.Thealgorithm’sperfor-manceismostlyindependentofthescenecomplexityandthesource’ssize.Occludersandreceiversdonotneedtobeseparatedandnoknowledgeaboutthescenerepresenta-tionisrequired,makingthemethodeasytouse.Themainideaistoapproximatetheocclusioninthescenewithpre-(cid:2)lteredocclusiontextures.Thevisibilityofthelightsourceatapointinspaceisestimatedbyaccumulatingtheocclu-sioncausedbyeachtexture,usinganovelformulabasedonprobabilities.Thisistheauthor’sversionofthework.Itispostedhereforpersonaluseonly,notforredistribution.Thede(cid:2)nitiveversionwaspublishedinProceedingsoftheBrazilianSymposiumonComputerGraphicsandIm-ageProcessing,19(SIBGRAPI)-2006byIEEE.ItisavailableonlineviatheSIBGRAPIdigitallibrary.1IntroductionShadowsareveryimportanttoestimatethespatialre-lationshipsofobjectsandtoconveyasenseofrealism.Formanyyears,computergraphicsconcentratedmostlyonpointlightswhichcreatehardshadows,surfacesbeingei-therlitornot.Intherealworld,mostlightsourcesarenotpunctualandcreatesoftshadowsmadeofumbraandpenumbraregions.Intheumbranodirectlightarrives,whereasinthepenumbrathelightsourceisonlypartiallyoccluded.Theincominglight,orirradiance,atasmallsur-faceisgivenbyadoubleintegraloverthesurfaceandthelightsource,ofafunctioninvolvingenergy,visibilityandorientation.Severalapproaches[3,4,5],haveshownthattheimportantinformationforconvincingshadowsliesinthevisibilitycontribution.Orientationcanbefactoredout∗ARTISisateamoftheGRAVIR/IMAGlaboratory,ajointeffortofCNRS,INRIA,INPGandUJFoftheintegral.Theproblemthussimpli(cid:2)estothecalcu-lationofthelight’svisibleportion,whichyetrepresentsachallengingtask.Thispaperpresentsanovelwaytoesti-matethisvisibilityfunctionwiththefollowingproperties:•theresultingshadowsareplausible,continuousandsmooth,andaccountforrealpenumbrae(notjustex-tendedumbrae);•thequalityandspeedofthemethodisindependentofthesizeofthelightsourceandthepenumbrae;•thealgorithmisalmostindependentofscenecomplex-ity,doesnotrequireinformationaboutthesceneandintegrateswellwithvariousrenderingparadigms(ver-texshaders,pointandimagebasedrendering...);•inparticular,thereisnoneedtodistinguishshadowcastersfromreceivers.Ourapproachisinspiredbypreviouswork[20,26]andex-ploitscurrentgraphicshardwaretoobtainreal-timeperfor-manceforhighlycomplexscenes.2PreviousworkLotsofresearchfocusedonshadowsandanexhaustivepresentationisnotpossiblehere.Wereferthereaderto[31,18]forsurveys.Pointlightsourcesdonotcreatepenumbraeandrepre-sentadirectequivalencetopoint-point-visibility.Thisisexploitedbyimagebasedtechniquessuchasshadowmap-ping[29].Usingimagesresultsinindependencetotheac-tualscenecomplexitywhichisinterestingforcomplicatedobjects.Ontheotherhand,thediscretenatureofimagesleadstoaliasing.Percentagecloser(cid:2)ltering[25,8,28].usesseveralshadowmapsamplestosmooththejaggyboundaryofhardshadows.In[14],statisticsareusedtosmooththealiasing,butcanintroducelightleaks.Shadowvolumes[10]givehigherquality,buttheyarepotentiallycostlyforcomplexscenes,liketrees,whereal-mostalledgesisasilhouette.Shadowquadsoverdrawandsilhouettedetectionbecometooexpensive.0
1
0
2

 
t
c
O
3
1

 

 
-
 

i

 

1
n
o
s
r
e
v
 
,

6
2
2
0
1
5
0
0
-
a
i
r
n

i

Inprinciplesoftshadowscouldbecreatedbyevaluat-ingseveralpointlights.Ifsamplingistoocoarse,bandingoccurs.Usingtoomanysamplesyieldsexpensivecreationandevaluation[28],therefore,approximatemethodshavebeenproposed.BrabecandSeidelcalculatemaximumun-occludedradiionadepthmaptoapproximatesoftshad-ows[7].In[21],appropriatewidthvaluesareprecalculatedinaspecialmap.Shadowmapshavebeenusedin[27]tocalculate,inapreprocess,aspecialdeepshadowmapforastaticlightsource,encodingocclusionforeachpointofastaticscene.Dynamicobjectscanbeinsertedbutcannotcastsoftshadows.Thesomewhatoppositestrategywaspre-sentedbyZhouetal.[34];shadowinformationisfaithfullyprecalculatedperobject.Thesestaticelementscanthenbeuseddynamically.Duetohugestoragenecessities,there-sultiscompressedonbasisfunctionswhichareevaluatedatrun-timeateachscenevertex,involvingsorting.Agrawalaetal.[1]warpseveraldepthimagestoobtainlayeredatten-uationmapswhichcanbeevaluatedquicklyatrun-time.Asthepreprocessisquiteinvolving,lightsourceandscenehavetobeconsideredstatic.Apurelyimagebasedap-proachhasbeenpresentedbyArvoetal.[2].Thecameraviewis(cid:2)lteredtodetecthardshadowboundaries.Flood(cid:2)llisusedtocreatepenumbraebasedondepthmapinfor-mation.Thisisnotwellsupportedbythecurrentgraph-icshardware.Thecostdependsheavilyonthesizeofthepenumbraonthescreen,whichcanbelargedependingonviewpointandlightsource.Asinnerpenumbracreationisanerosion,overlappingumbrasleadtoacompletedisap-pearanceandtemporalincoherence.Althoughnotphysi-callycorrect,theirgoalwastocreateplausibleshadows.Weworkinthesamecontext.RecentlyAttyetal.[6]pre-sentedanapproachbasedonasingledepthmap.Separatingoccluderandreceiver,depthmappixelsreplacetheactualoccluderandareprojectedonthereceivingground.ThealgorithmgivesconvincingresultsathighframeratesbutinvolvesCPUusagewhichlimitstextureresolution.Guen-nebaudetal.[17]presentedarelatedtechniquethatelim-inatesmostconstraintsbuthaslinearrun-timecomplexitywithrespecttothesource’ssize.Shadowvolumesextensionsforsoftshadowshavebeenpresentedin[3,4,5].Thesegeometry-basedwedgesgivehighqualityshadowsbutrelyonsilhouettedetermina-tionfromthecenterofthesource.Samplingartifactsareavoidedandlightsourcescanbetextured[4],buttheap-proachesareunsuitableforhighlycomplexmodels.Thecombinationofthecontributionsofdifferentoccludersisdonebyadditiveaccumulation.Hybridapproacheslike[9]encountersuchproblemstoo.Heresupplementaryprim-itivesareattachedtosilhouettestodescribetheblockingin(cid:3)uenceoftheedge.Itiscloselyrelatedto[24]andre-sultsinaliasfree,notsoft,shadows,justlike[32].In[20],thesceneisreplacedbyanMDI(Multipledepthimage)ob-tainedontheCPU,andray-tracingisperformedagainstthisalternativerepresentation.Thereareseveralsimilaritiestoourmethodandwewillhaveamoreprecisediscussioninsection4.3OurapproachAsexplainedinintroduction,weapproximatetheshadowintensityatapointPforarectangularlightsourceSinthepresenceofanoccluderObytheintegral:I(P):=(cid:90)SvP(S)dS(1)wherevPisthevisibilityfunctionde(cid:2)nedby:vP:S∈S→1if[P,S]∩O=∅else0(2)Inotherwords,wecountthenumberofraysfromPtoSthatarenotblockedbyO.Theshadowintensityfunctionisthreedimensionalandgenerallyverycomplex.Insubse-quentsections,wedescribeaGPUfriendlyapproximation.3.1SingleplanaroccluderFirstweconsiderasingleplanaroccluderparalleltothelightsource.ItisfullydescribedbyitsupportingplaneΠOanditscharacteristicfunctioninthatplane:δ:ΠO(cid:55)→{0,1},Q→1ifQ∈Oelse0(3)Considerthefrustumde(cid:2)nedbyapointPandthelight,andtheregionwhereitintersectstheoccluderplane.ThereisabijectionbetweenthatregionandlightrayspassingthroughP.Therefore,theshadowintensityatPistheintegralof1−δoverthisregion,normalizedbytheregions’ssize(Fig.1).Becausethelightisrectangularandparalleltotheoccluder,filterPLight sourceOccluderFigure1.Shadowintensityasa(cid:2)lter.thisregionisarectanglewhosesizedependssolelyonthedistancesofPtothelightandoccluderplanes:s(P):=d(P,ΠO)d(P,ΠS)×size(S)(4)0
1
0
2

 
t
c
O
3
1

 

 
-
 

i

 

1
n
o
s
r
e
v
 
,

6
2
2
0
1
5
0
0
-
a
i
r
n

i

Theintegralcanbecomputedby(cid:2)ltering1−δwithabox(cid:2)lterofsizes(P).Ourapproachistoencode1−δasaanocclusiontextureandtoprocessit,asdescribedinnextsection,suchthatapointPcanbeshadedbysimplycom-putings(P)usingeq.(4)andperformingalookupoftheappropriately(cid:2)lteredresult.3.2FastboxﬁlteringTo(cid:2)lteranocclusiontexturewitharectangularker-nel,wetriedthreeapproaches:Mipmapping,NBuffersandSummedAreaTables.Mipmappingwasintroducedtoreducealiasingofmini-(cid:2)edtextures[30].Itlinearlyinterpolatesbetweendyadicallydownsampledversionsofthetexture.Itisiswidelysup-portedbyGPUsandwasanaturalcandidateto(cid:2)lteroc-cludertextures.Inparticular,rectangularkernelsaresup-portedwithanisotropic(cid:2)ltering.Thankstolinearinterpo-lation,usingmipmappinggivessmoothlyvaryingshadows(Fi.2,top).However,itsuffersfromblockyartefactsthatbecomeparticularlynoticeablewhenthesceneisanimated.Thisisbecausethedyadicdownsamplingmaycombinead-jacenttexelsonlyatveryhighlevelsinthemipmappyra-mid.Therefore,aslightshiftoftheocclusiontexturecanleadtolargevariationsofthe(cid:2)lteredfunction.Toalleviatethisproblem,D·ecoretintroducedtheNBuffers[12]toallowpre(cid:2)lteringwithcontinuouslyplacedkernels.Weusethemtocomputethemeanvalueofneigh-boringpixels.Eachlevellholds,foreachtexel,thenor-malizedresponseofabox(cid:2)lterwithakernelsizeof2l×2l.Vialinearinterpolation,intermediatekernelsizescanbeap-proximated.Itstilldoesnotcomputetheexact(cid:2)lteredfunc-tion,butitsigni(cid:2)cantlyreducestheblockyartifacts(Fig.2bottom)inparticularfordynamicscenes.TheconstructionofNBuffersisextremelyfast.Fora256×256texture,8lev-elsneedtobecreated,eachofresolution256×256.Ap-proximately500Mpixelsareprocessed,eachrequiringex-actly4texturelookups.Moderngraphiccardscanperformmorethan50timesthisamountofworkat30fps.Interestingly,the(cid:2)lteringbyarectangularkernelcanbeexactlycomputedusingSummedAreaTables(SAT)[11].Unfortunately,althoughanef(cid:2)cientGPUimplementationhasbeenrecentlyproposed[19],thisapproachstillsuffersfromseverallimitations.First,32bittexturesarerequiredorsevereprecisionartifactswillappear1.Currently,lin-earinterpolationforsuchtexturesisnotnativelysupported(thisiswhytexelsarenoticeableontheclose-upofFig.2).Moreover,creationandtransferofsuchtexturesincreasethebandwidth,slowingdowntheprocess.Speedisalsoim-pededbythe4texturelookupsrequiredtogetthe(cid:2)lter’sre-sponse,whenNBuffersrequireonlyone.Finally,contrary1Shiftingthevalues,assuggestedbytheauthors,isnotusefulinourcase,duetothebitmasknatureofoccludertexturestoNBuffers,thenormalisationbythekernelsizecannotbeembeddedandthusrequiresextracomputations.However,asexpectable,theresultingqualityishigher,buttheim-provementdoesnotcompensatetheperformancepenalty.Wehaveimplementedthethreeapproaches.Figure2showsaqualitativeandquantitativecomparison.Inouropinion,NBuffersarecurrentlythebesttradeoffbetweenperformanceandquality.Onfuturehardwarethough,SATmayprovefastenoughtobecomethepreferredsolution.Inparticular,itusesasingletexturewhichismorecachefriendlythanthemultipletexturesrequiredbyNBuffers.resolutionMipmapSATNBuffers(top)(middle)(bottom)256×256<1ms32ms3ms512×512<1ms139ms11msFigure2.Comparisonof(cid:2)lteringmethods.3.3MultipleplanaroccludersLet’snowconsidertwoormoreplanaroccluders.Theshadowscausedbyeachoccluderindependentlycanbecomputedasbefore.However,combiningtheseshadowsisanotablydif(cid:2)cultproblem.Aspointedoutin[26],thecorrectsolutionliesbetweenthesumandthemaximumoftheoccluders’contributions.Intuitively,twooccluderscancoverdisjointoroverlappingpartsofthelightsource.Previousapproachesmoreorlessaddressthisproblem.In[26],themeanvaluebetweenthesetwocasesissug-gestedasanadhocsolution.Assarsonetal.usewedgestoaddorsubtractlight,andarethusinherentlyboundtocom-binethemadditively[3,4,5].Duringtheir(cid:3)ood(cid:2)ll,Arvoetal.[2]needtokeeptrackofthetexelinashadowmapresponsibleforocclusion.Whencombiningtheocclusionfortwosuchtexels,ithastomakeachoiceandthereforeselectstheonewithmaximumocclusion.Additiveapproachesquicklysaturate(itproducesocclu-sionvaluesgreaterthan100%thatmustbeclamped)andoverestimatetheumbra:shadowslooktoodarkandcreate0
1
0
2

 
t
c
O
3
1

 

 
-
 

i

 

1
n
o
s
r
e
v
 
,

6
2
2
0
1
5
0
0
-
a
i
r
n

i

unrealisticshadowgradients.Takingthemaximumvaluegivesvisuallymoreappealingresults,buttendstocreatetoobrightshadows,inparticulariftheoccludersareratherunstructured,likethefoliageofatree.Takingtheaveragedoesnotmakethatmuchsenseeither,becausethemaxi-mumonlytakesasingleoccluderintoaccount,whereasthesuminvolvesalloccluders.Thustherangesofthesetwovaluesaretoodifferenttobemeaningfullyaveraged.Weproposeanovelwaytocombinethecontributionsbasedonprobabilities.OurkeyobservationisthattheprobabilitythatarayfromPtoSisnotblockedbytheconsideredplanaroccluderisexactly1−V(P),whereVistheshadowintensityfunctiongivenbyeq.(1).Ifweconsiderseveraloccluderswithauniformdistributionofocclusion,theprobabilitythatarayisnotblockedbytheunionoftheoccludersistheproductoftheprobabilities.Thusweproposetocombinetheshadowintensitiesofseveraloccludersusing:I1,...,n(P):=n(cid:89)k=1(1−Ik(P))(5)Thisformulahasthesameadvantagesasthesum.Ifanoccluderdoesnotblockanyray(Ik(P)=0),itdoesnotin(cid:3)uencetheresult.Ifitblocksallrays(Ik(P)=1),theresultingintensityiszero.Comparedtothemaximum,itdoescombinealloccludersinsteadofselectingonlyone.Figure3showsacomparison.3.4GeneralsceneTotreatgeneralscenes,weapproximatetheocclusiontheycancausewithseveralocclusiontextures.Wecutthesceneinslicesparalleltothelightsource,andprojectev-erythinginsideasliceonitsbottomplane(theonefurthestfromthelightsource).Sinceweonlyneedbinaryinfor-mationintheoccludertextures,approacheslikeslicemaps[13,16]canbeusedtoobtainmanyslicesandwouldreadilybeusablewithourapproach.However,themoresliceswehave,themoretexturelookupswemustdotocomputethecombinedshadow(notethatthecostofpre-(cid:2)lteringisneglectable).Inpractice,weobservedthat4to16slicesisagoodtradeoffbetweenspeedandaccuracy.Thuslightweightmethodssuchas[23]canbeused.Weperformasinglerenderingpassandasimplefrag-mentshadertoconstructonetofourRGBAtextures(usingMRTs).The4to16colorchannelseachrepresentoneoc-cludertexture.ThispassisveryfastanddoesnotinterferewithanyCPUorGPUbasedvertexanimation.Itcanac-tuallybeusedwithanymodellingprimitiveandrenderingmethodthatproducesadepth,suchaspoint-basedrender-ing,impostors,ray-tracingonGPU.Onebene(cid:2)tofpack-ingoccludertexturesincolorchannelsisthatmipmapping,NBuffersorSATcanbethencomputedforfourslicesinonestep.Thin occluderOpaque occlusion texelLight sourceLight leakFigure4.Orthogonalprojection(left)causesmorelightleaksthanperspectiveone(right).Thecamerausedduringthisrenderingpassisveryim-portantasitcontrolshowthesceneissliced.Usinganor-thogonalprojectionhastwodisadvantages.First,averylargetextureresolutionisrequiredforthecamera’sfrus-tumtoencompassthescene.Second,theprojectionontoocclusiontexturesbreakscontinuoussurfacesintopatchesalonglinesnotfollowingthefrustumcenter.Theconse-quenceisthatlotoflightcanshinethroughwhereitisactu-allyblockedbytherealsurface,causinglightleaks(Fig.4).Withperspectiveprojection,theprobabilitytohavelightleaksismuchlower.Figure(4)showsthedifference.Onthis(cid:2)gure,youcanseethatthecenterofprojection(COP)isnotplacedonthelightsource.Thereasonistwofold.First,itwouldrequirealarge(cid:2)eldofviewtoencompassthescene,increasingtexturedistorsion.Second,duringtheshadowcomputations,thiswillinvolvekernelsthatarelargeandthatcanjutoutfromtheocclusiontextures(Fig.5).Thiswouldstraightentheartifactsofthepre-(cid:2)lteringmethods(interpolationorprecisionissues).OurchoiceistoplacetheCOPslightlybehindthelightsource,atadistancedandto(cid:2)tthefrustumtothelightsource,choosingdsothatthefrustumcontainsthescene.WewanttoemphasizethatusingaprojectionfromaparticularCOPonlyaffectsthewaywe(cid:147)x-ray(cid:148)thescenetoapproximateocclusion,nottheareaswhereshadowsarecomputed.Itdoesnotrelatetotheapproximationofsilhouetteedgesfromthecenterofthelightsourceasinothermethods.Lightleaks.Aswehaveseen,ourchoiceofperspectiveprojectional-readylimitsthelightleaks,butsomemaystilloccur.Itwillbecomeparticularlyvisibleinthecaseofthingeome-try,suchasabutter(cid:3)ywings(Fig.6).Forsuchgeometry,we0
1
0
2

 
t
c
O
3
1

 

 
-
 

i

 

1
n
o
s
r
e
v
 
,

6
2
2
0
1
5
0
0
-
a
i
r
n

i

Figure3.Comparisonofmaximum(left),sum(middle)andourcombiningapproach(right).Kernel is almost of the size of the occlusion texture and even juts out on the rightKernel are much smaller and never jut out with our offset projectionkernel size comparedto occlusion texture sizeFigure5.COPwithoffset:FilteringissimplerFigure6.Fixinglightleaksforthinoccluders.projecteachocclusiontextureonitssuccessorfartherawayfromthesourceinorderto(cid:147)close(cid:148)thediscontinuities.Real-ize,thatthisprojectioncanbeperformedvirtually.Duringtheslicecreation,whenconvertingdistanceintoacolor,itissuf(cid:2)cientto(cid:2)llthesucceedingchanneltoo.Thisintroducesnoextracosts.Figure6showshowitdrasticallyreducestheleaks.Thismethoddoesprobablynothandleallsituationsbutinpractice,wedidnotencounteranyleaksduringourtests.Projectingocclusiontexturesinthiswayaffectsthere-sultingshadowsbutonlyslightly.Umbraearealittleover-estimatedandtheshadowgradientslightlydiffers.Conse-quently,onecandecidetoenablethiscorrectionuniquelyforthinobjects,asforotherslightleakswillbeunlikely.SliceOcclusion Texture...would indicate that point P is in shadow!P Using the occlusion texture of the slice containing P...Figure7.Auto-shadowinginsideaslice.Selfshadowing.Ourmethoddoesnotdistinguishshadowcastersandre-ceivers.Everypointinthesceneisshadowed,usingonlytheoccludertexturesbetweenitandthelightsource.Theocclusiontexturecorrespondingtotheslicecontainingthepointisnotused,becauseanypointintheslicewouldbeshadowedbyitsownprojectionintheocclusiontexture(Fig.7).Simplyignoringthecontainingslicewouldcausediscontinuitieswherethegeometrycrossesclippingplanes.Instead,welinearlyfadeoutthecontributionofaslicede-pendingonthedistanceoftheshadedpointtotheslice’slowerclippingplane.Usingslicesforselfocclusionisacoarseapproximation,butitoftenworkswellinpracticeforthefollowingreasons.Foraslicefarawayfromapoint,theocclusiontextureactu-allyprovidesagoodapproximationoftheocclusioncausedbywhatisintheslice.Foraslicenearbyapoint,itisthe-oreticallymoreproblematicbutisoftenconcealedbydif-fuseillumination.Indeed,forawatertightobject,thefront-facingfacesblocklightfromtheback-facingones.Whentheyfallinthesameslice,thiseffectismissed.How-ever,thediffuseilluminationforback-facingfacesiszeroanddominatestheincorrectshadowing.Theyappeardarkastheyshould(Fig.8).Fornon-watertightchaoticobjectsliketrees,thediffuseilluminationcontainshighfrequencieswhichhidepotentiallyincorrectshadowing.Weinsistthatthisconcernsonlynearbyslices.Fordistantslices,self-0
1
0
2

 
t
c
O
3
1

 

 
-
 

i

 

1
n
o
s
r
e
v
 
,

6
2
2
0
1
5
0
0
-
a
i
r
n

i

shadowingbehavescorrectlyandinparticular,wedonotneedtodistinguishcastersfromreceivers.Figure8.Ourshadowing(left)maymisscloseself-occlusions.Fortunatelydiffuseil-luminationoftencompensates(right).3.5PuttingeverythingtogetherFigure9summarizesthealgorithm.Thesceneisslicedandprojectedontoocclusiontextures,whichinvolvesonerenderingofthescenefromthelight’spointofview(Sec.3.4).Theseocclusiontexturesarepre-(cid:2)lteredwithdifferentkernelsizes(Sec.3.2).Asecondrenderpassisperformedfromtheobserver’spointofview.ForeachpointPofthescene,allslicesbetweenitandthelightsourcearevisited.Theshadowcausedbyeachsliceisdeterminedbyperformingatexturelookupwitha(cid:2)ltersizecorrespondingtotheprojectionoflightonthesliceasseenfromP.Theshadowcontributionsarecombinedusingtheformula(5)whichperformsbetterthanthemaximumortheadditiveapproach(Sec.3.3).ThecontributionofthesliceclosesttoPisweightedaccordingtothedistanceofPtotheslice,inordertoobtainsmoothinter-slicevariationoftheshadowintensity.Theresultisthencombinedwithper-pixelPhongshadingandtextures.3.6ImplementationdetailsConceptually,ouralgorithmissimple.Thefragmentshadermustgettheworldcoordinatesofthecurrentfrag-ment,andloopovertheocclusiontextures.Foreach,itcomputestheappropriatekernelsizeandthendeducesthetwolevelsoftheNBuffertointerpolateforthe(cid:2)lterre-sponse.However,thisconversionisacomplexformula.Moreover,itisnotpossibletorandomlyindexanarrayoftexturesinashader.Fortunately,itispossibletorewritethisconceptualalgorithminapracticalone.Wemaintainacur-rentsliceindex,startingwiththeoneclosesttothepoint.WethenloopovertheNBufferlevels.Insidetheloop,ifthekernelsizerequiredforthecurrentsliceisbetweenthatofthecurrentandnextlevels,weaccumulatetheshadowcontributionandupdatethecurrentsliceindex.Thisworksbecausethekernelsizesareincreasingalongtheslices.Varioustricksareused,suchasusingswizzlingmaskstoincreasethecurrentsliceindex,knowingthatslicesarepackedinRGBAchannels(s=float4(1,0,0,0);s=s.wxyz;).Moreover,sincewehave4to16occlu-siontextureswithseveralNBufferlevelsforeach,thelimitof16textureunitsisreachedandtexturepackingoftheNBuffersmustbedone2.Adetaileddescriptionwasbe-yondthescopeofthispaper.Pleaserefertoitswebpagefordetails(viatheauthors’webpagesonhttp://artis.imag.fr/).4ResultsanddiscussionWeimplementedourmethodusingCg1.4shadinglan-guageandOpenGL,runningonaPentium4withaGeForce7800.Figure10showssomeresults.BoththerenderpasstoslicethesceneandthecomputationsofNBuffersareveryfast,thustherenderingcostofourmethodisdominatedbythe(cid:2)nalrenderpassandisalmostthesameinallourtests.For800×600images,werunbetween20Hzand30Hz.Mostoftheimagesweshowarelevelsofgray.Thisistoemphasizetheshadows.Ourmethodworksseamlesslywithtexturesandwouldevenbene(cid:2)tfromtheirpresence,sincetexturemapswouldmaskminorshadowingartifacts.Similarly,mostofourexamplesshowcastshadowsona(cid:3)atgroundtoeasetheperception.Anarbitrarygroundispossible,andwewanttoemphasizeagainthatthereisnocaster/receiverdistinctioninourmethods.Ourshadowsareplausibleandsmoothevenforextremelowresolutionofocclusiontextures.Separately,eachsingleocclusiontextureispiecewiselinearandhasablockyap-pearance.Combiningnon-alignedtexturesleadstoanarti-(cid:2)cialincreaseofresolution.Thiscanbeinterpretedintermsoffrequencies[15].Slicescanbeseenasadecompositionoftheshadowonbasisfunctions.Eachsliceislooked-upwithdistinct(cid:2)ltersizeandthusrepresentsaseparaterangeoffrequencies.Acombinationisawealthofinformation,thatisnotequivalenttoasingletexture.Nevertheless,toolowresolutionswouldstillintroduceartifactsduringani-mation.Also,asthesmallestentityisapixel,theblockingcontributionofvery(cid:2)neobjectscanbeoverestimatedormissed.Liketheantennasin(cid:2)gure6whichblocktoomuchlight.Thisisaproblemthatwesharewithallimagebasedmethods.2Notethatthisdoesnotcauseproblemswith(cid:2)lteringbecauseourker-nelsarealwaysentirelycontainedintheoccludertexture(seeSec.3.4)0
1
0
2

 
t
c
O
3
1

 

 
-
 

i

 

1
n
o
s
r
e
v
 
,

6
2
2
0
1
5
0
0
-
a
i
r
n

i

Figure9.Summaryofouralgorithm.OurworkissimilarinspirittothatofKeatingandMax[20]butthe(cid:2)eldofapplicationiscompletelydifferent.Theirapproachdoesnotaimatrealtimeandtargetsray-tracing.Withoutaveragingseveralrays,itisstillpresentedinaformthatwouldnotallowreal-timeperformance.Itusesconvolutionmostlytoavoidnoiseandappliesitsim-ilarlytopercentagecloser(cid:2)ltering[25].Instead,weuseconvolutionforaccelerationpurposes.Wepresentedsev-eralsolutionstoapproximate(cid:2)lteringef(cid:2)ciently,ratherthanperformingit.Ourmethodthustreatslargelightsourceswithoutpenalty.OcclusiontexturesarecreatedontheGPUwhereasMDIsarecreatedontheCPU.Wecombinecon-tributionsdifferently,basedonprobability,andobtaincon-vincingresultswithoutevaluatingseveralsamplerays.Ofcourse,samplingproducesmorerealisticimages.5ConclusionandFutureWorkWepresentedanovelimage-basedsoftshadowalgo-rithm,thatisfastandespeciallywell-adaptedtoGPU.Itdoesnotrelyonprecalculationandintegratessmoothlywithanimatedscenes.Theresultingshadowsareplausi-blealthoughnotphysicallycorrect.Inparticular,innerandouterpenumbraearehandled.Althoughthemethodisimagebased,shadowsaresmooth,evenatlowtextureresolution.Someartifactscanoccur,duetothelimitednumberofslices/resolutionandapproximated(cid:2)ltering;self-occlusionmightfaillocallyandaslight(cid:3)ickeringcanoc-curforverticalmovementsastheweightingfortheclosestslicechanges.However,thecomplextaskofinter-objectshadingisseamlesslyhandled,throughtheintroductionofanovelwayofcombiningshadowcontributionsbasedonprobabilities.Nodistinctionbetweencastersandreceiversisrequired.Themethodisoutputsensitivedependingonlyontheamountofshadedpointsratherthanonthenatureorsizeoftheshadow.Toourbestknowledgeitistheonlyapproachthatpossessesalltheseproperties.AspointedoutbyHasenfratzetal.[18],anunsolvedproblemistoprovidebestsoftshadowsforagiventimeconstraint.Ouralgorithmgetsquiteclosetothisgoal.Itsrun-timeismostlypredictableanddependsonthenumberofshadowedpixelsinthe(cid:2)naloutput.Currentlyweinves-tigateusingforwardshadowmapping[33]tocalculateaso-lutionasseenfromthelightandtransferitbacktothe(cid:2)naloutput.Theslicestructuremakesthispossible.This(cid:2)xesinadvancethenumberoffragmentsaswellasthenumberoftexturelookupsandspeedbecomescompletelycontrollableviaresolution.Animportantareaoffutureinvestigationconcernsthesliceplacement.Slicingcouldberestrictedtothepartofthescenethatcancastshadowsthatarevisiblebytheobserver.Litmapsintroducedin[12],orCCShadowvolumes[22]couldservethatpurpose.Itispossibletocreateperobjectrepresentations,following[34].Thisrelatestotheideathatwhentheviewerorsomeelementsofthescenemove,theslicesshouldevolveina(cid:147)continuous(cid:148)way.Finally,hierarchicalbranchingcouldbeinteresting,asonelookupgivesusinformationaboutfourslices.Onourtesthardware(GeForce6800TD-7800),itiscurrentlycheapertodoalotmoreworkthanbranching.Thisshows,thatingeneralshaderoptimizationbecomesdif(cid:2)cultandwedidnotfocusonthistopic,asourapproachisalreadyfast.Optimizationsarecertainlypossible,especiallyonassem-blerlevelorwithrespecttothecard’sarchitecture.Acknowledgements:Wethanktheanonymousreview-ersfortheirinsightfulcommentsandremarks.SpecialthanksgotoSylvainLefebvreforhishelpfulsuggestions,severaldiscussionsandveryearlyinput.WewouldalsoliketothankespeciallyCyrilSolerandHedlenadeAlmeidaBezerraforseveraldiscussions.TheworkwasfoundedbytheregionRhone-Alpes(Dereve).0
1
0
2

 
t
c
O
3
1

 

 
-
 

i

 

1
n
o
s
r
e
v
 
,

6
2
2
0
1
5
0
0
-
a
i
r
n

i

Figure10.Examplesofourmethod.Noticetheselfshadowingandthesmoothnessofshadows.Imagesarerenderedatabout25Hzataresolutionof800×600using16occlusiontexturesof512×512.References[1]M.Agrawala,R.Ramamoorthi,A.Heirich,andL.Moll.Ef(cid:2)cientimage-basedmethodsforrenderingsoftshadows.InProc.ofSiggraph’00,2000.[2]J.Arvo,M.Hikorpi,andJ.Tyystj¤arvi.Approximatesoftshadowswithanimag-space(cid:3)ood-(cid:2)ll-algorithm.InProc.ofEurographics’04,2004.[3]U.AssarsonandT.Akenine-M¤oller.Approximatesoftshad-owsonarbitrarysurfacesusingpenumbrawedges.InProc.ofWorkshoponRendering’02,SpringerComputerScience.Eurographics,Eurographics,2002.[4]U.AssarsonandT.Akenine-M¤oller.Ageometry-basedsoftshadowvolumealgorithmusinggraphicshardware.InProc.ofSiggraph’03,2003.[5]U.Assarson,M.Dougherty,M.Mounier,andT.Akenine-M¤oller.Anoptimizedsoftshadowvolumealgorithmwithreal-timeperformance.InProc.ofWorkshoponGraphicsHardware’03,2003.[6]L.Atty,N.Holzschuch,M.Lapierre,J.-M.Hasenfratz,C.Hansen,andF.Sillion.Softshadowmaps:Ef(cid:2)cientsam-plingoflightsourcevisibility.ComputerGraphicsForum,2006.[7]S.BrabecandH.Seidel.Singlesamplesoftshadowsusingdepthmaps.InProc.ofGraphicsInterface’02,2002.[8]S.BrabecandH.P.Seidel.Hardware-acceleratedrenderingofantialiasedshadowswithshadowmaps.InProceedingsofCGI’01,2001.[9]E.ChanandF.Durand.Renderingfakesoftshadowswithsmoothies.InProc.ofSymposiumonRendering’03,2003.[10]F.Crow.Shadowalgorithmsforcomputergraphics.incom-putergraphics.InProc.ofSiggraph’77,1977.[11]F.C.Crow.Summed-areatablesfortexturemapping.InProc.ofSiggraph’84,1984.[12]X.D·ecoret.N-buffersforef(cid:2)cientdepthmapquery.InProc.ofEurographics’05,2005.[13]Z.Dong,W.Chen,H.Bao,H.Zhang,andQ.Peng.Real-timevoxelizationforcomplexpolygonalmodels.InProc.ofPaci(cid:2)cGraphics’04,2004.[14]W.DonnellyandA.Lauritzen.Varianceshadowmaps.InProc.ofI3D’06,2006.[15]F.Durand,N.Holzschuch,C.Soler,E.Chan,andF.Sillion.Afrequencyanalysisoflighttransport.ACMTransactionsonGraphics(ProceedingsofSIGGRAPH2005),24(3),aug2005.[16]E.EisemannandX.D·ecoret.Fastscenevoxelizationandapplications.InProc.ofI3D’06,2006.[17]G.Guennebaud,L.Barthe,andM.Paulin.Real-timesoftshadowmappingbybackprojection.InEurographicsSym-posiumonRendering.[18]J.-M.Hasenfratz,M.Lapierre,N.Holzschuch,andF.Sil-lion.Asurveyofreal-timesoftshadowsalgorithms.Com-puterGraphicsForum,22(4),Dec.2003.[19]J.Hensley,T.Scheuermann,G.Coombe,A.Lastra,andM.Singh.Fastsummed-areatablegenerationanditsap-plications.InProc.ofEurographics’05,2005.[20]B.KeatingandN.Max.Shadowpenumbrasforcomplexobjectsbydepth-dependent(cid:2)lteringofmulti-layerdepthim-ages.InProc.ofWorkshoponRendering’99,1999.[21]F.KirschandJ.Doellner.Real-timesoftshadowsusingasinglelightsample.JournalofWSCG,2003.[22]B.Lloyd,J.Wendt,N.K.Govindaraju,andD.Manocha.Ccshadowvolumes.InProc.ofEGSymposiumonRen-dering’04,SpringerComputerScience.Eurographics,Eu-rographicsAssociation,2004.[23]H.NguyenandW.Donnelly.HairAnimationandRenderingintheNaluDemo.AddisonWesley,2005.[24]S.Parker,P.Shirley,andB.Smits.Singlesamplesoftshad-ows.TechnicalReportUUCS-98-019,UniversityofUtah,1998.[25]W.T.Reeves,D.H.Salesin,andR.L.Cook.Renderingan-tialiasedshadowswithdepthmaps.InProc.ofSiggraph’87,1987.[26]C.SolerandF.Sillion.Fastcalculationofsoftshadowtex-turesusingconvolution.InProc.ofSiggraph’98,1998.[27]J.-F.St-Amour,E.Paquette,andP.Poulin.Softshadowsfromextendedlightsourceswithpenumbradeepshadowmaps.InProc.ofGraphicsInterface’05,2005.[28]Y.Uralsky.Ef(cid:2)cientsoft-edgedshadowsusingpixelshaderbranching.InGPUGems2.AddisonWesley,2005.[29]L.Williams.Castingcurvedshadowsoncurvedsurfaces.InProc.ofSiggraph’78,1978.[30]L.Williams.Pyramidalparametrics.InProc.ofSig-graph’83,1983.[31]A.Woo,P.Poulin,andA.Fournier.Asurveyofshadowalgorithms.IEEEComput.Graph.Appl.,10(6),1990.[32]C.WymanandC.Hansen.Penumbramaps:Approximatesoftshadowsinreal-time.InProc.ofSymposiumonRen-dering’03,2003.[33]H.Zhang.Forwardshadowmapping.InProc.ofWorkshoponRendering’98,1998.[34]K.Zhou,Y.Hu,S.Lin,B.Guo,andH.-Y.Shum.Precom-putedshadow(cid:2)eldsfordynamicscenes.InProc.ofSig-graph’05,2005.